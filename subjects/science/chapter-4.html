<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organisms & Environments - 5th Grade Science</title>
    <link rel="stylesheet" href="../../css/main.css">
    <link rel="stylesheet" href="../../css/responsive.css">
</head>
<body>
    <div id="header-container"></div>
    <main class="chapter-container">
        <div class="chapter-header">
            <div class="chapter-number">Chapter 4</div>
            <h1 class="chapter-title">Organisms & Environments</h1>
            <p class="chapter-description">Discover living things, their habitats, food chains, and how organisms interact with their environment.</p>
        </div>
        <div class="lesson-content">
            <!-- Ecosystem Builder -->
            <div class="experiment-station">
                <h3><span class="section-icon">🌲</span>Ecosystem Builder</h3>
                <div class="ecosystem-container">
                    <div class="ecosystem-canvas" id="ecosystem-canvas">
                        <div class="ecosystem-layer sky">
                            <div class="weather-effects" id="weather-effects"></div>
                        </div>
                        <div class="ecosystem-layer ground">
                            <div class="organisms-container" id="organisms-container"></div>
                        </div>
                        <div class="ecosystem-info" id="ecosystem-info">
                            <h4>Your Ecosystem</h4>
                            <div class="population-stats" id="population-stats">
                                <div>Producers: <span id="producer-count">0</span></div>
                                <div>Primary Consumers: <span id="primary-count">0</span></div>
                                <div>Secondary Consumers: <span id="secondary-count">0</span></div>
                                <div>Decomposers: <span id="decomposer-count">0</span></div>
                            </div>
                        </div>
                    </div>
                    <div class="organism-selector">
                        <h4>Add Organisms:</h4>
                        <div class="organism-categories">
                            <div class="category producers">
                                <h5>Producers (Plants)</h5>
                                <div class="organism-buttons">
                                    <button onclick="addOrganism('tree')">🌳 Tree</button>
                                    <button onclick="addOrganism('flower')">🌸 Flower</button>
                                    <button onclick="addOrganism('grass')">🌿 Grass</button>
                                    <button onclick="addOrganism('algae')">🌊 Algae</button>
                                </div>
                            </div>
                            <div class="category primary-consumers">
                                <h5>Primary Consumers (Herbivores)</h5>
                                <div class="organism-buttons">
                                    <button onclick="addOrganism('rabbit')">🐰 Rabbit</button>
                                    <button onclick="addOrganism('deer')">🦌 Deer</button>
                                    <button onclick="addOrganism('butterfly')">🦋 Butterfly</button>
                                    <button onclick="addOrganism('bee')">🐝 Bee</button>
                                </div>
                            </div>
                            <div class="category secondary-consumers">
                                <h5>Secondary Consumers (Carnivores)</h5>
                                <div class="organism-buttons">
                                    <button onclick="addOrganism('hawk')">🦅 Hawk</button>
                                    <button onclick="addOrganism('fox')">🦊 Fox</button>
                                    <button onclick="addOrganism('snake')">🐍 Snake</button>
                                    <button onclick="addOrganism('frog')">🐸 Frog</button>
                                </div>
                            </div>
                            <div class="category decomposers">
                                <h5>Decomposers</h5>
                                <div class="organism-buttons">
                                    <button onclick="addOrganism('mushroom')">🍄 Mushroom</button>
                                    <button onclick="addOrganism('bacteria')">🦠 Bacteria</button>
                                    <button onclick="addOrganism('worm')">🪱 Worm</button>
                                </div>
                            </div>
                        </div>
                        <div class="ecosystem-controls">
                            <button onclick="clearEcosystem()">🗑️ Clear All</button>
                            <button onclick="simulateEcosystem()">▶️ Simulate</button>
                            <button onclick="analyzeEcosystem()">🔍 Analyze Balance</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Food Chain Constructor -->
            <div class="experiment-station">
                <h3><span class="section-icon">🍽️</span>Food Chain Constructor</h3>
                <div class="food-chain-builder">
                    <div class="food-chain-canvas">
                        <div class="chain-slot" data-level="1" ondrop="drop(event)" ondragover="allowDrop(event)">
                            <div class="slot-label">Producer</div>
                            <div class="slot-content" id="slot-1">Drop a producer here</div>
                        </div>
                        <div class="chain-arrow">→</div>
                        <div class="chain-slot" data-level="2" ondrop="drop(event)" ondragover="allowDrop(event)">
                            <div class="slot-label">Primary Consumer</div>
                            <div class="slot-content" id="slot-2">Drop a herbivore here</div>
                        </div>
                        <div class="chain-arrow">→</div>
                        <div class="chain-slot" data-level="3" ondrop="drop(event)" ondragover="allowDrop(event)">
                            <div class="slot-label">Secondary Consumer</div>
                            <div class="slot-content" id="slot-3">Drop a carnivore here</div>
                        </div>
                        <div class="chain-arrow">→</div>
                        <div class="chain-slot" data-level="4" ondrop="drop(event)" ondragover="allowDrop(event)">
                            <div class="slot-label">Decomposer</div>
                            <div class="slot-content" id="slot-4">Drop a decomposer here</div>
                        </div>
                    </div>
                    <div class="organism-bank">
                        <h4>Drag organisms to build your food chain:</h4>
                        <div class="draggable-organisms">
                            <div class="organism-card" draggable="true" data-type="producer" data-name="grass" ondragstart="drag(event)">🌿<br>Grass</div>
                            <div class="organism-card" draggable="true" data-type="producer" data-name="tree" ondragstart="drag(event)">🌳<br>Tree</div>
                            <div class="organism-card" draggable="true" data-type="primary" data-name="rabbit" ondragstart="drag(event)">🐰<br>Rabbit</div>
                            <div class="organism-card" draggable="true" data-type="primary" data-name="deer" ondragstart="drag(event)">🦌<br>Deer</div>
                            <div class="organism-card" draggable="true" data-type="secondary" data-name="fox" ondragstart="drag(event)">🦊<br>Fox</div>
                            <div class="organism-card" draggable="true" data-type="secondary" data-name="hawk" ondragstart="drag(event)">🦅<br>Hawk</div>
                            <div class="organism-card" draggable="true" data-type="decomposer" data-name="mushroom" ondragstart="drag(event)">🍄<br>Mushroom</div>
                            <div class="organism-card" draggable="true" data-type="decomposer" data-name="bacteria" ondragstart="drag(event)">🦠<br>Bacteria</div>
                        </div>
                    </div>
                    <div class="food-chain-controls">
                        <button onclick="validateFoodChain()">✅ Validate Chain</button>
                        <button onclick="clearFoodChain()">🗑️ Clear Chain</button>
                        <button onclick="showEnergyFlow()">⚡ Show Energy Flow</button>
                    </div>
                    <div class="chain-feedback" id="chain-feedback" style="display: none;"></div>
                </div>
            </div>

            <!-- Habitat Matching Game -->
            <div class="experiment-station">
                <h3><span class="section-icon">🏠</span>Habitat Matching Game</h3>
                <div class="habitat-game">
                    <div class="habitats-row">
                        <div class="habitat-zone" data-habitat="forest" ondrop="dropAnimal(event)" ondragover="allowDrop(event)">
                            <h4>🌲 Forest</h4>
                            <div class="habitat-description">Trees, shade, moderate temperature</div>
                            <div class="animals-in-habitat" id="forest-animals"></div>
                        </div>
                        <div class="habitat-zone" data-habitat="desert" ondrop="dropAnimal(event)" ondragover="allowDrop(event)">
                            <h4>🏜️ Desert</h4>
                            <div class="habitat-description">Hot, dry, sandy, little water</div>
                            <div class="animals-in-habitat" id="desert-animals"></div>
                        </div>
                        <div class="habitat-zone" data-habitat="ocean" ondrop="dropAnimal(event)" ondragover="allowDrop(event)">
                            <h4>🌊 Ocean</h4>
                            <div class="habitat-description">Saltwater, waves, marine environment</div>
                            <div class="animals-in-habitat" id="ocean-animals"></div>
                        </div>
                        <div class="habitat-zone" data-habitat="arctic" ondrop="dropAnimal(event)" ondragover="allowDrop(event)">
                            <h4>🏔️ Arctic</h4>
                            <div class="habitat-description">Very cold, snow, ice</div>
                            <div class="animals-in-habitat" id="arctic-animals"></div>
                        </div>
                    </div>
                    <div class="animals-to-match">
                        <h4>Drag each animal to its correct habitat:</h4>
                        <div class="animal-cards" id="animal-cards">
                            <div class="animal-card" draggable="true" data-animal="bear" data-habitat="forest" ondragstart="dragAnimal(event)">🐻<br>Bear</div>
                            <div class="animal-card" draggable="true" data-animal="whale" data-habitat="ocean" ondragstart="dragAnimal(event)">🐋<br>Whale</div>
                            <div class="animal-card" draggable="true" data-animal="camel" data-habitat="desert" ondragstart="dragAnimal(event)">🐪<br>Camel</div>
                            <div class="animal-card" draggable="true" data-animal="penguin" data-habitat="arctic" ondragstart="dragAnimal(event)">🐧<br>Penguin</div>
                            <div class="animal-card" draggable="true" data-animal="owl" data-habitat="forest" ondragstart="dragAnimal(event)">🦉<br>Owl</div>
                            <div class="animal-card" draggable="true" data-animal="shark" data-habitat="ocean" ondragstart="dragAnimal(event)">🦈<br>Shark</div>
                            <div class="animal-card" draggable="true" data-animal="lizard" data-habitat="desert" ondragstart="dragAnimal(event)">🦎<br>Lizard</div>
                            <div class="animal-card" draggable="true" data-animal="seal" data-habitat="arctic" ondragstart="dragAnimal(event)">🦭<br>Seal</div>
                        </div>
                    </div>
                    <div class="game-stats" id="game-stats">
                        <div>Correct: <span id="correct-count">0</span></div>
                        <div>Remaining: <span id="remaining-count">8</span></div>
                        <button onclick="resetHabitatGame()">🔄 Reset Game</button>
                    </div>
                </div>
            </div>

            <!-- Plant Life Cycle Simulator -->
            <div class="experiment-station">
                <h3><span class="section-icon">🌱</span>Plant Life Cycle Simulator</h3>
                <div class="life-cycle-simulator">
                    <div class="cycle-visualization">
                        <div class="cycle-stage" id="stage-seed" onclick="selectStage('seed')">
                            <div class="stage-visual">🌰</div>
                            <div class="stage-label">Seed</div>
                        </div>
                        <div class="cycle-arrow">→</div>
                        <div class="cycle-stage" id="stage-germination" onclick="selectStage('germination')">
                            <div class="stage-visual">🌱</div>
                            <div class="stage-label">Germination</div>
                        </div>
                        <div class="cycle-arrow">→</div>
                        <div class="cycle-stage" id="stage-seedling" onclick="selectStage('seedling')">
                            <div class="stage-visual">🌿</div>
                            <div class="stage-label">Seedling</div>
                        </div>
                        <div class="cycle-arrow">→</div>
                        <div class="cycle-stage" id="stage-adult" onclick="selectStage('adult')">
                            <div class="stage-visual">🌳</div>
                            <div class="stage-label">Adult Plant</div>
                        </div>
                        <div class="cycle-arrow">→</div>
                        <div class="cycle-stage" id="stage-flower" onclick="selectStage('flower')">
                            <div class="stage-visual">🌸</div>
                            <div class="stage-label">Flowering</div>
                        </div>
                        <div class="cycle-arrow">→</div>
                        <div class="cycle-stage" id="stage-fruit" onclick="selectStage('fruit')">
                            <div class="stage-visual">🍎</div>
                            <div class="stage-label">Fruit/Seeds</div>
                        </div>
                    </div>
                    <div class="stage-details" id="stage-details">
                        <h4>Plant Life Cycle</h4>
                        <p>Click on any stage to learn what happens during that phase of a plant's life.</p>
                    </div>
                    <div class="life-cycle-controls">
                        <button onclick="startLifeCycleAnimation()">▶️ Play Animation</button>
                        <button onclick="pauseLifeCycleAnimation()">⏸️ Pause</button>
                        <button onclick="resetLifeCycle()">🔄 Reset</button>
                        <div class="speed-control">
                            <label>Speed: <span id="cycle-speed">1x</span></label>
                            <input type="range" id="cycle-speed-slider" min="0.5" max="3" step="0.5" value="1">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Organisms Quiz Challenge -->
            <div class="experiment-station quiz-station">
                <h3><span class="section-icon">🧬</span>Organisms & Environment Knowledge Challenge</h3>
                <div class="quiz-container" id="organisms-quiz">
                    <div class="quiz-question" id="organisms-quiz-question">
                        <p>Which of these is a producer in an ecosystem?</p>
                        <div class="quiz-options">
                            <button onclick="checkOrganismsAnswer('A', true)">A) Grass</button>
                            <button onclick="checkOrganismsAnswer('B', false)">B) Rabbit</button>
                            <button onclick="checkOrganismsAnswer('C', false)">C) Fox</button>
                            <button onclick="checkOrganismsAnswer('D', false)">D) Mushroom</button>
                        </div>
                    </div>
                    <div class="quiz-feedback" id="organisms-quiz-feedback" style="display: none;"></div>
                    <div class="quiz-progress">
                        <span>Question <span id="organisms-question-number">1</span> of <span id="organisms-total-questions">7</span></span>
                        <div class="quiz-score">Score: <span id="organisms-quiz-score">0</span>/7</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="chapter-navigation">
            <a href="chapter-3.html" class="nav-button">← Previous</a>
            <div class="progress-indicator">
                <div class="progress-text">Progress</div>
                <div class="progress-bar"><div class="progress-fill" style="width: 25%"></div></div>
            </div>
            <a href="chapter-5.html" class="nav-button">Next →</a>
        </div>
    </main>
    <div id="footer-container"></div>
    <script src="../../js/app.js" defer></script>
    <script>
        // Load shared components
        function loadSharedComponents() {
            fetch('../shared/header.html').then(r => r.text()).then(h => document.getElementById('header-container').innerHTML = h);
            fetch('../shared/footer.html').then(r => r.text()).then(h => document.getElementById('footer-container').innerHTML = h);
        }
        document.readyState === 'loading' ? document.addEventListener('DOMContentLoaded', loadSharedComponents) : loadSharedComponents();

        // Global variables for organisms and environment activities
        let ecosystemOrganisms = [];
        let currentLifeCycleStage = 0;
        let lifeCycleAnimation = null;
        let cycleAnimationSpeed = 1;
        let currentOrganismsQuestion = 0;
        let organismsQuizScore = 0;
        let correctMatches = 0;
        let remainingAnimals = 8;

        // Organism data for ecosystem builder
        const organismTypes = {
            // Producers
            tree: { type: 'producer', emoji: '🌳', name: 'Tree', energy: 100 },
            flower: { type: 'producer', emoji: '🌸', name: 'Flower', energy: 80 },
            grass: { type: 'producer', emoji: '🌿', name: 'Grass', energy: 60 },
            algae: { type: 'producer', emoji: '🌊', name: 'Algae', energy: 70 },
            // Primary Consumers (Herbivores)
            rabbit: { type: 'primary', emoji: '🐰', name: 'Rabbit', energy: 40 },
            deer: { type: 'primary', emoji: '🦌', name: 'Deer', energy: 50 },
            butterfly: { type: 'primary', emoji: '🦋', name: 'Butterfly', energy: 20 },
            bee: { type: 'primary', emoji: '🐝', name: 'Bee', energy: 25 },
            // Secondary Consumers (Carnivores)
            hawk: { type: 'secondary', emoji: '🦅', name: 'Hawk', energy: 30 },
            fox: { type: 'secondary', emoji: '🦊', name: 'Fox', energy: 35 },
            snake: { type: 'secondary', emoji: '🐍', name: 'Snake', energy: 25 },
            frog: { type: 'secondary', emoji: '🐸', name: 'Frog', energy: 20 },
            // Decomposers
            mushroom: { type: 'decomposer', emoji: '🍄', name: 'Mushroom', energy: 10 },
            bacteria: { type: 'decomposer', emoji: '🦠', name: 'Bacteria', energy: 5 },
            worm: { type: 'decomposer', emoji: '🪱', name: 'Worm', energy: 15 }
        };

        // Plant life cycle stages
        const lifeCycleStages = [
            {
                name: 'Seed',
                visual: '🌰',
                description: 'A seed contains the embryo of a new plant and stored food. It needs water, warmth, and oxygen to begin growing.',
                details: 'Seeds can remain dormant for months or even years until conditions are right for germination.'
            },
            {
                name: 'Germination',
                visual: '🌱',
                description: 'The seed absorbs water and begins to sprout. The root grows down and the shoot grows up toward light.',
                details: 'This process usually takes 3-10 days depending on the type of plant and environmental conditions.'
            },
            {
                name: 'Seedling',
                visual: '🌿',
                description: 'A young plant with its first leaves. It starts making its own food through photosynthesis.',
                details: 'Seedlings are fragile and need protection from harsh weather, pests, and diseases.'
            },
            {
                name: 'Adult Plant',
                visual: '🌳',
                description: 'The plant is fully grown with a strong root system, stem, and many leaves for making food.',
                details: 'Adult plants can live for many years, continuously growing and producing energy through photosynthesis.'
            },
            {
                name: 'Flowering',
                visual: '🌸',
                description: 'The plant produces flowers to attract pollinators like bees and butterflies for reproduction.',
                details: 'Flowers contain male (pollen) and female (ovule) parts needed to create new seeds.'
            },
            {
                name: 'Fruit/Seeds',
                visual: '🍎',
                description: 'After pollination, fruits develop to protect seeds. Animals eat fruit and spread seeds to new places.',
                details: 'This completes the cycle as seeds are dispersed to grow into new plants in different locations.'
            }
        ];

        // Quiz questions about organisms and environments
        const organismsQuestions = [
            {
                question: "Which of these is a producer in an ecosystem?",
                options: ["A) Grass", "B) Rabbit", "C) Fox", "D) Mushroom"],
                correct: 0,
                explanation: "Grass is a producer because it makes its own food through photosynthesis using sunlight, water, and carbon dioxide."
            },
            {
                question: "What do we call animals that eat only plants?",
                options: ["A) Carnivores", "B) Herbivores", "C) Omnivores", "D) Decomposers"],
                correct: 1,
                explanation: "Herbivores are animals that eat only plants. Examples include rabbits, deer, and butterflies."
            },
            {
                question: "Which organism breaks down dead plants and animals?",
                options: ["A) Producer", "B) Primary consumer", "C) Secondary consumer", "D) Decomposer"],
                correct: 3,
                explanation: "Decomposers like mushrooms, bacteria, and worms break down dead organisms and return nutrients to the soil."
            },
            {
                question: "What would happen if all the producers disappeared from an ecosystem?",
                options: ["A) Nothing would change", "B) Only carnivores would survive", "C) The entire food chain would collapse", "D) More animals would appear"],
                correct: 2,
                explanation: "Without producers, there would be no food for herbivores, which would affect carnivores too, causing the whole ecosystem to collapse."
            },
            {
                question: "Which habitat would a polar bear live in?",
                options: ["A) Desert", "B) Forest", "C) Arctic", "D) Ocean"],
                correct: 2,
                explanation: "Polar bears are adapted to live in the Arctic with thick fur, fat layers, and hunting skills for icy conditions."
            },
            {
                question: "What do plants need for photosynthesis?",
                options: ["A) Sunlight only", "B) Water only", "C) Sunlight, water, and carbon dioxide", "D) Soil only"],
                correct: 2,
                explanation: "Plants need sunlight for energy, water from roots, and carbon dioxide from air to make food through photosynthesis."
            },
            {
                question: "In a food chain, energy flows from:",
                options: ["A) Carnivores to herbivores", "B) Decomposers to producers", "C) Producers to consumers", "D) Consumers to producers"],
                correct: 2,
                explanation: "Energy flows from producers (plants) to primary consumers (herbivores) to secondary consumers (carnivores)."
            }
        ];

        // Initialize all systems when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeEcosystem();
            initializeFoodChain();
            initializeHabitatGame();
            initializeLifeCycle();
            initializeOrganismsQuiz();
        });

        // Ecosystem Builder Functions
        function initializeEcosystem() {
            updatePopulationStats();
        }

        function addOrganism(type) {
            const organism = organismTypes[type];
            if (!organism) return;

            const ecosystemCanvas = document.getElementById('organisms-container');
            const organismDiv = document.createElement('div');
            organismDiv.className = 'organism-in-ecosystem';
            organismDiv.innerHTML = `<span class="organism-emoji">${organism.emoji}</span>`;
            
            // Random positioning
            const x = Math.random() * 80 + 10; // 10% to 90% to avoid edges
            const y = Math.random() * 80 + 10;
            organismDiv.style.left = x + '%';
            organismDiv.style.top = y + '%';
            
            // Add click to remove
            organismDiv.onclick = function() {
                ecosystemCanvas.removeChild(organismDiv);
                const index = ecosystemOrganisms.findIndex(o => o.element === organismDiv);
                if (index > -1) {
                    ecosystemOrganisms.splice(index, 1);
                    updatePopulationStats();
                }
            };
            
            ecosystemCanvas.appendChild(organismDiv);
            ecosystemOrganisms.push({ ...organism, element: organismDiv });
            updatePopulationStats();
        }

        function updatePopulationStats() {
            const stats = {
                producer: 0,
                primary: 0,
                secondary: 0,
                decomposer: 0
            };
            
            ecosystemOrganisms.forEach(org => {
                stats[org.type]++;
            });
            
            document.getElementById('producer-count').textContent = stats.producer;
            document.getElementById('primary-count').textContent = stats.primary;
            document.getElementById('secondary-count').textContent = stats.secondary;
            document.getElementById('decomposer-count').textContent = stats.decomposer;
        }

        function clearEcosystem() {
            document.getElementById('organisms-container').innerHTML = '';
            ecosystemOrganisms = [];
            updatePopulationStats();
        }

        function simulateEcosystem() {
            const organisms = document.querySelectorAll('.organism-in-ecosystem');
            organisms.forEach(org => {
                // Simple animation to show ecosystem activity
                org.style.animation = 'bounce 2s ease-in-out';
                setTimeout(() => {
                    org.style.animation = '';
                }, 2000);
            });
        }

        function analyzeEcosystem() {
            const stats = {
                producer: ecosystemOrganisms.filter(o => o.type === 'producer').length,
                primary: ecosystemOrganisms.filter(o => o.type === 'primary').length,
                secondary: ecosystemOrganisms.filter(o => o.type === 'secondary').length,
                decomposer: ecosystemOrganisms.filter(o => o.type === 'decomposer').length
            };
            
            let analysis = "Ecosystem Analysis:\n";
            
            if (stats.producer === 0) {
                analysis += "⚠️ No producers! Ecosystem will collapse without plants.\n";
            } else if (stats.producer < 3) {
                analysis += "⚠️ Few producers. Add more plants for a stable ecosystem.\n";
            } else {
                analysis += "✅ Good number of producers providing energy.\n";
            }
            
            if (stats.primary > stats.producer * 2) {
                analysis += "⚠️ Too many herbivores for available plants.\n";
            }
            
            if (stats.secondary > stats.primary) {
                analysis += "⚠️ Too many carnivores for available prey.\n";
            }
            
            if (stats.decomposer === 0) {
                analysis += "⚠️ No decomposers! Dead matter won't break down.\n";
            }
            
            if (stats.producer >= 3 && stats.decomposer > 0 && stats.primary <= stats.producer * 2) {
                analysis += "✅ Balanced ecosystem! Great job!";
            }
            
            alert(analysis);
        }

        // Food Chain Functions
        function initializeFoodChain() {
            // Initialize drag and drop
        }

        function allowDrop(ev) {
            ev.preventDefault();
        }

        function drag(ev) {
            ev.dataTransfer.setData("text", ev.target.dataset.name);
            ev.dataTransfer.setData("type", ev.target.dataset.type);
        }

        function drop(ev) {
            ev.preventDefault();
            const organismName = ev.dataTransfer.getData("text");
            const organismType = ev.dataTransfer.getData("type");
            const slot = ev.currentTarget;
            const slotLevel = slot.dataset.level;
            
            // Check if organism fits the slot type
            const slotTypes = {
                '1': 'producer',
                '2': 'primary',
                '3': 'secondary', 
                '4': 'decomposer'
            };
            
            if (organismType === slotTypes[slotLevel]) {
                const organism = organismTypes[organismName];
                slot.querySelector('.slot-content').innerHTML = `${organism.emoji}<br>${organism.name}`;
                slot.classList.add('filled');
            } else {
                alert('That organism doesn\'t belong in this slot!');
            }
        }

        function validateFoodChain() {
            const slots = document.querySelectorAll('.chain-slot');
            let filledSlots = 0;
            let validChain = true;
            
            slots.forEach(slot => {
                if (slot.classList.contains('filled')) {
                    filledSlots++;
                }
            });
            
            const feedback = document.getElementById('chain-feedback');
            if (filledSlots === 4) {
                feedback.innerHTML = '<div class="correct">✅ Perfect! You\'ve created a complete food chain!</div>';
            } else {
                feedback.innerHTML = '<div class="incorrect">❌ Your food chain is incomplete. Fill all slots!</div>';
            }
            feedback.style.display = 'block';
        }

        function clearFoodChain() {
            const slots = document.querySelectorAll('.chain-slot');
            slots.forEach((slot, index) => {
                const labels = ['Drop a producer here', 'Drop a herbivore here', 'Drop a carnivore here', 'Drop a decomposer here'];
                slot.querySelector('.slot-content').textContent = labels[index];
                slot.classList.remove('filled');
            });
            document.getElementById('chain-feedback').style.display = 'none';
        }

        function showEnergyFlow() {
            alert('Energy flows from the Sun → Producers (10%) → Primary Consumers (1%) → Secondary Consumers (0.1%). Only about 10% of energy transfers between each level!');
        }

        // Habitat Matching Functions
        function initializeHabitatGame() {
            // Game is ready
        }

        function dragAnimal(ev) {
            ev.dataTransfer.setData("animal", ev.target.dataset.animal);
            ev.dataTransfer.setData("correct-habitat", ev.target.dataset.habitat);
        }

        function dropAnimal(ev) {
            ev.preventDefault();
            const animal = ev.dataTransfer.getData("animal");
            const correctHabitat = ev.dataTransfer.getData("correct-habitat");
            const droppedHabitat = ev.currentTarget.dataset.habitat;
            
            // Find the animal card
            const animalCard = document.querySelector(`[data-animal="${animal}"]`);
            
            if (correctHabitat === droppedHabitat) {
                // Correct match
                ev.currentTarget.querySelector('.animals-in-habitat').appendChild(animalCard);
                animalCard.style.background = '#e8f5e8';
                animalCard.draggable = false;
                correctMatches++;
                remainingAnimals--;
                
                // Play success sound or animation
                animalCard.style.animation = 'bounce 0.5s ease';
            } else {
                // Incorrect match - return to original position
                animalCard.style.animation = 'shake 0.5s ease';
                setTimeout(() => {
                    animalCard.style.animation = '';
                }, 500);
            }
            
            updateGameStats();
            
            if (remainingAnimals === 0) {
                setTimeout(() => {
                    alert('🎉 Congratulations! You\'ve matched all animals to their correct habitats!');
                }, 500);
            }
        }

        function updateGameStats() {
            document.getElementById('correct-count').textContent = correctMatches;
            document.getElementById('remaining-count').textContent = remainingAnimals;
        }

        function resetHabitatGame() {
            // Reset all animals to original position
            const animalCards = document.querySelectorAll('.animal-card');
            const originalContainer = document.getElementById('animal-cards');
            
            animalCards.forEach(card => {
                card.style.background = '';
                card.style.animation = '';
                card.draggable = true;
                originalContainer.appendChild(card);
            });
            
            correctMatches = 0;
            remainingAnimals = 8;
            updateGameStats();
        }

        // Plant Life Cycle Functions
        function initializeLifeCycle() {
            selectStage('seed');
            
            document.getElementById('cycle-speed-slider').addEventListener('input', function() {
                cycleAnimationSpeed = parseFloat(this.value);
                document.getElementById('cycle-speed').textContent = cycleAnimationSpeed + 'x';
            });
        }

        function selectStage(stageName) {
            const stageIndex = lifeCycleStages.findIndex(stage => 
                stage.name.toLowerCase().replace(/[^a-z]/g, '') === stageName
            );
            
            if (stageIndex === -1) return;
            
            currentLifeCycleStage = stageIndex;
            const stage = lifeCycleStages[stageIndex];
            
            // Update visual selection
            document.querySelectorAll('.cycle-stage').forEach(el => el.classList.remove('selected'));
            document.getElementById(`stage-${stageName}`).classList.add('selected');
            
            // Update details
            document.getElementById('stage-details').innerHTML = `
                <h4>${stage.name}</h4>
                <p><strong>What happens:</strong> ${stage.description}</p>
                <p><strong>Details:</strong> ${stage.details}</p>
            `;
        }

        function startLifeCycleAnimation() {
            if (lifeCycleAnimation) return;
            
            lifeCycleAnimation = setInterval(() => {
                currentLifeCycleStage = (currentLifeCycleStage + 1) % lifeCycleStages.length;
                const stageNames = ['seed', 'germination', 'seedling', 'adult', 'flower', 'fruit'];
                selectStage(stageNames[currentLifeCycleStage]);
            }, 3000 / cycleAnimationSpeed);
        }

        function pauseLifeCycleAnimation() {
            if (lifeCycleAnimation) {
                clearInterval(lifeCycleAnimation);
                lifeCycleAnimation = null;
            }
        }

        function resetLifeCycle() {
            pauseLifeCycleAnimation();
            selectStage('seed');
        }

        // Organisms Quiz Functions
        function initializeOrganismsQuiz() {
            loadOrganismsQuestion();
        }

        function loadOrganismsQuestion() {
            if (currentOrganismsQuestion >= organismsQuestions.length) {
                showOrganismsResults();
                return;
            }
            
            const question = organismsQuestions[currentOrganismsQuestion];
            document.getElementById('organisms-quiz-question').innerHTML = `
                <p>${question.question}</p>
                <div class="quiz-options">
                    ${question.options.map((option, index) => 
                        `<button onclick="checkOrganismsAnswer(${index}, ${index === question.correct})">${option}</button>`
                    ).join('')}
                </div>
            `;
            
            document.getElementById('organisms-question-number').textContent = currentOrganismsQuestion + 1;
            document.getElementById('organisms-quiz-feedback').style.display = 'none';
        }

        function checkOrganismsAnswer(selectedIndex, isCorrect) {
            const question = organismsQuestions[currentOrganismsQuestion];
            const feedback = document.getElementById('organisms-quiz-feedback');
            
            if (isCorrect) {
                organismsQuizScore++;
                feedback.innerHTML = `<div class="correct">✅ Correct! ${question.explanation}</div>`;
            } else {
                feedback.innerHTML = `<div class="incorrect">❌ Incorrect. ${question.explanation}</div>`;
            }
            
            feedback.style.display = 'block';
            document.getElementById('organisms-quiz-score').textContent = organismsQuizScore;
            
            // Disable buttons
            document.querySelectorAll('#organisms-quiz-question .quiz-options button').forEach(btn => btn.disabled = true);
            
            // Auto-advance after 3 seconds
            setTimeout(() => {
                currentOrganismsQuestion++;
                loadOrganismsQuestion();
            }, 3000);
        }

        function showOrganismsResults() {
            const percentage = Math.round((organismsQuizScore / organismsQuestions.length) * 100);
            const resultMessage = percentage >= 80 ? 
                "🌟 Excellent! You understand ecosystems very well!" :
                percentage >= 60 ? 
                "🌱 Good work! You know a lot about organisms and environments!" :
                "🔍 Keep exploring! Try the interactive activities to learn more.";
            
            document.getElementById('organisms-quiz-question').innerHTML = `
                <div class="quiz-complete">
                    <h3>Quiz Complete!</h3>
                    <p>Your Score: ${organismsQuizScore}/${organismsQuestions.length} (${percentage}%)</p>
                    <p>${resultMessage}</p>
                    <button onclick="restartOrganismsQuiz()">Take Quiz Again</button>
                </div>
            `;
        }

        function restartOrganismsQuiz() {
            currentOrganismsQuestion = 0;
            organismsQuizScore = 0;
            document.getElementById('organisms-quiz-score').textContent = '0';
            loadOrganismsQuestion();
        }
    </script>
    
    <style>
        /* Organisms & Environment Interactive Styles */
        .experiment-station {
            background: linear-gradient(135deg, #f8f9fa 0%, #e8f5e8 100%);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border: 2px solid #4caf50;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.1);
        }

        /* Ecosystem Builder Styles */
        .ecosystem-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        .ecosystem-canvas {
            position: relative;
            height: 400px;
            background: linear-gradient(to bottom, #87ceeb 0%, #90EE90 50%, #8b4513 100%);
            border-radius: 15px;
            overflow: hidden;
        }

        .ecosystem-layer {
            position: absolute;
            width: 100%;
        }

        .sky {
            height: 30%;
            top: 0;
        }

        .ground {
            height: 70%;
            bottom: 0;
        }

        .organisms-container {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .organism-in-ecosystem {
            position: absolute;
            cursor: pointer;
            transition: transform 0.3s ease;
            animation: fadeIn 0.5s ease;
        }

        .organism-in-ecosystem:hover {
            transform: scale(1.2);
        }

        .organism-emoji {
            font-size: 1.8rem;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
        }

        .ecosystem-info {
            background: white;
            border-radius: 10px;
            padding: 20px;
        }

        .population-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .population-stats div {
            background: #f0f8ff;
            padding: 8px;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
        }

        .organism-selector {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .organism-categories {
            display: grid;
            gap: 15px;
        }

        .category {
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
        }

        .category h5 {
            margin: 0 0 10px 0;
            color: #333;
        }

        .producers { border-color: #4caf50; }
        .primary-consumers { border-color: #ff9800; }
        .secondary-consumers { border-color: #f44336; }
        .decomposers { border-color: #9c27b0; }

        .organism-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .organism-buttons button {
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .producers button { background: #e8f5e8; }
        .primary-consumers button { background: #fff3e0; }
        .secondary-consumers button { background: #ffebee; }
        .decomposers button { background: #f3e5f5; }

        .organism-buttons button:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .ecosystem-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        /* Food Chain Styles */
        .food-chain-builder {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
        }

        .food-chain-canvas {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .chain-slot {
            width: 120px;
            height: 120px;
            border: 3px dashed #ccc;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #f9f9f9;
            transition: all 0.3s ease;
        }

        .chain-slot:hover {
            border-color: #4caf50;
            background: #f0f8ff;
        }

        .chain-slot.filled {
            border-color: #4caf50;
            background: #e8f5e8;
            border-style: solid;
        }

        .slot-label {
            font-size: 11px;
            font-weight: bold;
            color: #666;
            margin-bottom: 5px;
        }

        .slot-content {
            text-align: center;
            font-size: 12px;
            color: #888;
        }

        .chain-arrow {
            font-size: 1.5rem;
            color: #4caf50;
            font-weight: bold;
        }

        .organism-bank {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .draggable-organisms {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .organism-card {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            cursor: grab;
            transition: all 0.3s ease;
            font-size: 11px;
        }

        .organism-card:hover {
            border-color: #4caf50;
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .organism-card:active {
            cursor: grabbing;
        }

        .food-chain-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .chain-feedback {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            animation: slideIn 0.3s ease;
        }

        /* Habitat Game Styles */
        .habitat-game {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
        }

        .habitats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .habitat-zone {
            border: 3px dashed #ccc;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            min-height: 150px;
            transition: all 0.3s ease;
        }

        .habitat-zone:hover {
            border-color: #4caf50;
            background: #f0f8ff;
        }

        .habitat-zone h4 {
            margin: 0 0 8px 0;
            font-size: 1.1rem;
        }

        .habitat-description {
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
        }

        .animals-in-habitat {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            justify-content: center;
        }

        .animals-to-match {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .animal-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .animal-card {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            cursor: grab;
            transition: all 0.3s ease;
            font-size: 11px;
        }

        .animal-card:hover {
            border-color: #4caf50;
            transform: translateY(-2px);
        }

        .game-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f0f8ff;
            padding: 10px 15px;
            border-radius: 8px;
        }

        /* Life Cycle Styles */
        .life-cycle-simulator {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
        }

        .cycle-visualization {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #e8f5e8, #f0f8ff);
            padding: 20px;
            border-radius: 10px;
        }

        .cycle-stage {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            border: 3px solid #ddd;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            min-width: 80px;
        }

        .cycle-stage:hover {
            border-color: #4caf50;
            transform: scale(1.05);
        }

        .cycle-stage.selected {
            border-color: #4caf50;
            background: #e8f5e8;
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.3);
        }

        .stage-visual {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .stage-label {
            font-size: 11px;
            font-weight: bold;
            color: #333;
        }

        .cycle-arrow {
            font-size: 1.5rem;
            color: #4caf50;
            font-weight: bold;
        }

        .stage-details {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            min-height: 120px;
        }

        .life-cycle-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Quiz Styles */
        .quiz-station {
            border-color: #8bc34a;
            background: linear-gradient(135deg, #f8f9fa 0%, #f1f8e9 100%);
        }

        /* Animation Keyframes */
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.5); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes bounce {
            0%, 20%, 60%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            80% { transform: translateY(-5px); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .ecosystem-container {
                grid-template-columns: 1fr;
            }
            
            .food-chain-canvas {
                flex-direction: column;
            }
            
            .chain-arrow {
                transform: rotate(90deg);
            }
            
            .habitats-row {
                grid-template-columns: 1fr 1fr;
            }
            
            .cycle-visualization {
                flex-direction: column;
            }
            
            .cycle-arrow {
                transform: rotate(90deg);
            }
        }
    </style>
</body>
</html>
