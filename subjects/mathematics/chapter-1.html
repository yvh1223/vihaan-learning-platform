<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Numbers & Operations - Interactive 5th grade mathematics lesson with place value, fractions, decimals, and visual learning">
    <meta name="keywords" content="5th grade, mathematics, numbers, operations, place value, fractions, decimals, STAAR, MAP">
    <meta name="author" content="Yallappa H">
    
    <title>Numbers & Operations - 5th Grade Mathematics | Learning Platform</title>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="../../css/main.css">
    <link rel="stylesheet" href="../../css/responsive.css">
    
    <style>
        /* Chapter-specific styles */
        .number-visual {
            font-family: 'Courier New', monospace;
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            text-align: center;
            padding: var(--spacing-lg);
            background-color: var(--bg-secondary);
            border-radius: var(--radius-md);
            margin: var(--spacing-lg) 0;
        }
        
        .place-value-chart {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: var(--spacing-sm);
            max-width: 500px;
            margin: var(--spacing-lg) auto;
            background-color: var(--bg-card);
            padding: var(--spacing-lg);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
        }
        
        .place-header {
            background-color: var(--primary-color);
            color: white;
            padding: var(--spacing-sm);
            text-align: center;
            font-weight: bold;
            font-size: var(--font-size-sm);
            border-radius: var(--radius-sm);
        }
        
        .place-digit {
            background-color: var(--accent-color);
            color: white;
            padding: var(--spacing-md);
            text-align: center;
            font-size: var(--font-size-xl);
            font-weight: bold;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .place-digit:hover {
            transform: scale(1.1);
            background-color: var(--secondary-color);
        }
        
        .fraction-visual {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--spacing-md);
            margin: var(--spacing-lg) 0;
        }
        
        .fraction-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 4px solid var(--primary-color);
            position: relative;
            background-color: var(--bg-secondary);
            overflow: hidden;
        }
        
        .fraction-fill {
            position: absolute;
            top: 0;
            left: 0;
            width: 50%;
            height: 100%;
            background-color: var(--secondary-color);
            border-radius: 120px 0 0 120px;
        }
        
        .fraction-label {
            font-size: var(--font-size-xl);
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .decimal-ruler {
            width: 100%;
            max-width: 600px;
            height: 60px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: var(--radius-md);
            margin: var(--spacing-lg) auto;
            position: relative;
            display: flex;
            align-items: center;
        }
        
        .decimal-markers {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100%;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            padding: 0 var(--spacing-sm);
        }
        
        .decimal-marker {
            width: 2px;
            background-color: white;
            opacity: 0.8;
        }
        
        .decimal-marker.major {
            height: 80%;
        }
        
        .decimal-marker.minor {
            height: 50%;
        }
        
        .decimal-label {
            position: absolute;
            bottom: -25px;
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
            font-weight: bold;
        }
        
        .operation-demo {
            background-color: var(--bg-card);
            padding: var(--spacing-xl);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            margin: var(--spacing-lg) 0;
        }
        
        .math-problem {
            font-size: var(--font-size-xxl);
            font-weight: bold;
            color: var(--primary-color);
            text-align: center;
            margin: var(--spacing-lg) 0;
            font-family: 'Courier New', monospace;
        }
        
        .step-by-step {
            display: grid;
            gap: var(--spacing-md);
        }
        
        .step {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            background-color: var(--bg-secondary);
            border-radius: var(--radius-md);
            border-left: 4px solid var(--secondary-color);
        }
        
        .step-number {
            background-color: var(--secondary-color);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: var(--font-size-sm);
        }
        
        .try-it-button {
            background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
            color: white;
            border: none;
            padding: var(--spacing-lg) var(--spacing-xl);
            border-radius: var(--radius-lg);
            font-size: var(--font-size-lg);
            font-weight: bold;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: block;
            margin: var(--spacing-lg) auto;
        }
        
        .try-it-button:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: var(--shadow-xl);
        }
    </style>
</head>
<body>
    <!-- Include Shared Header -->
    <div id="header-container"></div>
    
    <!-- Main Chapter Content -->
    <main class="chapter-container">
        <!-- Chapter Header -->
        <div class="chapter-header">
            <div class="chapter-number">Chapter 1</div>
            <h1 class="chapter-title">Numbers & Operations</h1>
            <p class="chapter-description">
                Master place value, fractions, decimals, and operations with whole numbers using visual models and hands-on activities!
            </p>
        </div>
        
        <!-- Lesson Content -->
        <div class="lesson-content">
            <!-- Section 1: Place Value -->
            <div class="lesson-section">
                <h3>
                    <span class="section-icon">üéØ</span>
                    Understanding Place Value
                </h3>
                
                <p>Place value helps us understand what each digit in a number means. Let's explore the number 23,456:</p>
                
                <div class="place-value-chart">
                    <div class="place-header">Ten Thousands</div>
                    <div class="place-header">Thousands</div>
                    <div class="place-header">Hundreds</div>
                    <div class="place-header">Tens</div>
                    <div class="place-header">Ones</div>
                    
                    <div class="place-digit" onclick="showPlaceValue('ten-thousands', 2)">2</div>
                    <div class="place-digit" onclick="showPlaceValue('thousands', 3)">3</div>
                    <div class="place-digit" onclick="showPlaceValue('hundreds', 4)">4</div>
                    <div class="place-digit" onclick="showPlaceValue('tens', 5)">5</div>
                    <div class="place-digit" onclick="showPlaceValue('ones', 6)">6</div>
                </div>
                
                <div class="visual-element">
                    <div class="placeholder-image">
                        üìä Interactive Place Value Manipulatives<br>
                        <small>Click on each digit above to see its value!</small>
                    </div>
                </div>
                
                <button type="button" class="try-it-button" onclick="startPlaceValueActivity()">
                    üéÆ Try Interactive Place Value Game
                </button>
            </div>
            
            <!-- Section 2: Fractions -->
            <div class="lesson-section">
                <h3>
                    <span class="section-icon">üçï</span>
                    Working with Fractions
                </h3>
                
                <p>Fractions represent parts of a whole. Let's visualize 1/2 using circles:</p>
                
                <div class="fraction-visual">
                    <div class="fraction-circle">
                        <div class="fraction-fill"></div>
                    </div>
                    <div class="fraction-label">=</div>
                    <div class="fraction-label">1/2</div>
                </div>
                
                <div class="operation-demo">
                    <h4>Adding Fractions with Same Denominators</h4>
                    <div class="math-problem">1/4 + 2/4 = ?</div>
                    
                    <div class="step-by-step">
                        <div class="step">
                            <div class="step-number">1</div>
                            <div>Since denominators are the same, add only the numerators: 1 + 2 = 3</div>
                        </div>
                        <div class="step">
                            <div class="step-number">2</div>
                            <div>Keep the same denominator: 3/4</div>
                        </div>
                        <div class="step">
                            <div class="step-number">3</div>
                            <div>Answer: 1/4 + 2/4 = 3/4</div>
                        </div>
                    </div>
                </div>
                
                <div class="visual-element">
                    <div class="placeholder-image">
                        üßÆ Fraction Circles and Bars<br>
                        <small>Visual fraction manipulatives for hands-on learning</small>
                    </div>
                </div>
                
                <button type="button" class="try-it-button" onclick="startFractionActivity()">
                    üéØ Practice Fraction Operations
                </button>
            </div>
            
            <!-- Section 3: Decimals -->
            <div class="lesson-section">
                <h3>
                    <span class="section-icon">üìè</span>
                    Understanding Decimals
                </h3>
                
                <p>Decimals are another way to write fractions. They use place value too!</p>
                
                <div class="number-visual">
                    2.45 = 2 ones + 4 tenths + 5 hundredths
                </div>
                
                <div class="decimal-ruler">
                    <div class="decimal-markers">
                        <div class="decimal-marker major">
                            <div class="decimal-label">0</div>
                        </div>
                        <div class="decimal-marker minor"></div>
                        <div class="decimal-marker minor"></div>
                        <div class="decimal-marker minor"></div>
                        <div class="decimal-marker minor"></div>
                        <div class="decimal-marker major">
                            <div class="decimal-label">0.5</div>
                        </div>
                        <div class="decimal-marker minor"></div>
                        <div class="decimal-marker minor"></div>
                        <div class="decimal-marker minor"></div>
                        <div class="decimal-marker minor"></div>
                        <div class="decimal-marker major">
                            <div class="decimal-label">1.0</div>
                        </div>
                    </div>
                </div>
                
                <div class="visual-element">
                    <div class="placeholder-image">
                        üìê Decimal Number Lines and Grids<br>
                        <small>Visual tools for comparing and ordering decimals</small>
                    </div>
                </div>
                
                <button type="button" class="try-it-button" onclick="startDecimalActivity()">
                    üî¢ Explore Decimal Place Value
                </button>
            </div>
            
            <!-- Section 4: Operations -->
            <div class="lesson-section">
                <h3>
                    <span class="section-icon">‚ûï</span>
                    Multi-digit Operations
                </h3>
                
                <p>Let's practice multi-digit addition and subtraction with regrouping!</p>
                
                <div class="operation-demo">
                    <h4>Addition with Regrouping</h4>
                    <div class="math-problem">
                        <div>  4 7 8</div>
                        <div>+ 2 5 6</div>
                        <div>_____</div>
                        <div>  ? ? ?</div>
                    </div>
                    
                    <div class="step-by-step">
                        <div class="step">
                            <div class="step-number">1</div>
                            <div>Add ones: 8 + 6 = 14. Write 4, carry 1</div>
                        </div>
                        <div class="step">
                            <div class="step-number">2</div>
                            <div>Add tens: 7 + 5 + 1 = 13. Write 3, carry 1</div>
                        </div>
                        <div class="step">
                            <div class="step-number">3</div>
                            <div>Add hundreds: 4 + 2 + 1 = 7. Write 7</div>
                        </div>
                        <div class="step">
                            <div class="step-number">4</div>
                            <div>Answer: 478 + 256 = 734</div>
                        </div>
                    </div>
                </div>
                
                <!-- More Addition with Regrouping Examples -->
                <div style="margin: 2rem 0; padding: 1.5rem; border: 2px solid #4A90E2; border-radius: 1rem; background: #f8f9ff;">
                    <h4>üìö More Addition with Regrouping Examples</h4>
                    <p>Practice with these step-by-step examples:</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-top: 1rem;">
                        <!-- Example 1 -->
                        <div style="background: white; padding: 1rem; border-radius: 0.5rem; border: 1px solid #ddd;">
                            <h5 style="color: #FF6B35; margin-bottom: 1rem;">Example 1: 365 + 287</h5>
                            <div class="math-problem" style="font-family: 'Courier New', monospace; font-size: 1.2rem; text-align: center; margin: 1rem 0;">
                                <div style="margin: 0.25rem 0;">  3 6 5</div>
                                <div style="margin: 0.25rem 0;">+ 2 8 7</div>
                                <div style="margin: 0.25rem 0;">_____</div>
                                <div style="margin: 0.25rem 0; color: #7ED321; font-weight: bold;">  6 5 2</div>
                            </div>
                            <div style="font-size: 0.9rem; color: #666;">
                                <div>üí° Ones: 5 + 7 = 12 (write 2, carry 1)</div>
                                <div>üí° Tens: 6 + 8 + 1 = 15 (write 5, carry 1)</div>
                                <div>üí° Hundreds: 3 + 2 + 1 = 6</div>
                            </div>
                        </div>
                        
                        <!-- Example 2 -->
                        <div style="background: white; padding: 1rem; border-radius: 0.5rem; border: 1px solid #ddd;">
                            <h5 style="color: #4ECDC4; margin-bottom: 1rem;">Example 2: 597 + 168</h5>
                            <div class="math-problem" style="font-family: 'Courier New', monospace; font-size: 1.2rem; text-align: center; margin: 1rem 0;">
                                <div style="margin: 0.25rem 0;">  5 9 7</div>
                                <div style="margin: 0.25rem 0;">+ 1 6 8</div>
                                <div style="margin: 0.25rem 0;">_____</div>
                                <div style="margin: 0.25rem 0; color: #7ED321; font-weight: bold;">  7 6 5</div>
                            </div>
                            <div style="font-size: 0.9rem; color: #666;">
                                <div>üí° Ones: 7 + 8 = 15 (write 5, carry 1)</div>
                                <div>üí° Tens: 9 + 6 + 1 = 16 (write 6, carry 1)</div>
                                <div>üí° Hundreds: 5 + 1 + 1 = 7</div>
                            </div>
                        </div>
                        
                        <!-- Example 3 -->
                        <div style="background: white; padding: 1rem; border-radius: 0.5rem; border: 1px solid #ddd;">
                            <h5 style="color: #9013FE; margin-bottom: 1rem;">Example 3: 789 + 456</h5>
                            <div class="math-problem" style="font-family: 'Courier New', monospace; font-size: 1.2rem; text-align: center; margin: 1rem 0;">
                                <div style="margin: 0.25rem 0;">  7 8 9</div>
                                <div style="margin: 0.25rem 0;">+ 4 5 6</div>
                                <div style="margin: 0.25rem 0;">_____</div>
                                <div style="margin: 0.25rem 0; color: #7ED321; font-weight: bold;">1 2 4 5</div>
                            </div>
                            <div style="font-size: 0.9rem; color: #666;">
                                <div>üí° Ones: 9 + 6 = 15 (write 5, carry 1)</div>
                                <div>üí° Tens: 8 + 5 + 1 = 14 (write 4, carry 1)</div>
                                <div>üí° Hundreds: 7 + 4 + 1 = 12 (write 2, carry 1)</div>
                                <div>üí° Thousands: 0 + 0 + 1 = 1</div>
                            </div>
                        </div>
                        
                        <!-- Example 4 -->
                        <div style="background: white; padding: 1rem; border-radius: 0.5rem; border: 1px solid #ddd;">
                            <h5 style="color: #F7931E; margin-bottom: 1rem;">Practice: 847 + 395</h5>
                            <div class="math-problem" style="font-family: 'Courier New', monospace; font-size: 1.2rem; text-align: center; margin: 1rem 0;">
                                <div style="margin: 0.25rem 0;">  8 4 7</div>
                                <div style="margin: 0.25rem 0;">+ 3 9 5</div>
                                <div style="margin: 0.25rem 0;">_____</div>
                                <div style="margin: 0.25rem 0; color: #999;">  ? ? ?</div>
                            </div>
                            <button type="button" onclick="revealAnswer('847 + 395 = 1,242')" style="width: 100%; padding: 0.5rem; background: #F7931E; color: white; border: none; border-radius: 0.25rem; cursor: pointer; margin-top: 0.5rem;">
                                üéØ Reveal Answer
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="interactive-activity">
                    <h4>üé≤ Roll & Calculate Challenge</h4>
                    <p>Practice your skills with randomly generated problems!</p>
                    <button type="button" class="activity-button" onclick="generateProblem()">
                        Generate New Problem
                    </button>
                </div>
            </div>

            <!-- Section 5: Quick Check -->
            <div class="lesson-section">
                <h3>
                    <span class="section-icon">‚úÖ</span>
                    Quick Check
                </h3>
                <p>Try these on your own. When you‚Äôre ready, open the answers.</p>
                <ol>
                    <li>What is the value of the 7 in 70,352?</li>
                    <li>Write 0.63 as a fraction in simplest form.</li>
                    <li>Find the sum: 426 + 389 = ?</li>
                    <li>Order from least to greatest: 0.5, 0.08, 0.75.</li>
                </ol>
                <details>
                    <summary>Show answers</summary>
                    <ul>
                        <li>70,000</li>
                        <li>63/100</li>
                        <li>815</li>
                        <li>0.08, 0.5, 0.75</li>
                    </ul>
                </details>
            </div>
        </div>
        
        <!-- Chapter Navigation -->
        <div class="chapter-navigation">
            <a href="index.html" class="nav-button">
                ‚Üê Back to Mathematics
            </a>
            
            <div class="progress-indicator">
                <div class="progress-text">Chapter Progress</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 25%"></div>
                </div>
            </div>
            
            <a href="chapter-2.html" class="nav-button">
                Next: Algebraic Reasoning ‚Üí
            </a>
        </div>
    </main>
    
    <!-- Include Shared Footer -->
    <div id="footer-container"></div>
    
    <!-- JavaScript -->
    <script src="../../js/app.js" defer></script>
    <script src="../../js/drag-drop-utils.js" defer></script>
    <script src="../../js/assessment-system.js" defer></script>
    <script src="../../js/multimedia-system.js" defer></script>
    <script src="../../js/gamification-system.js" defer></script>
    <script>
        // Chapter 1: Numbers & Operations JavaScript
        (function() {
            // Load shared components
            function loadSharedComponents() {
                // Load header
                fetch('../shared/header.html')
                    .then(response => response.text())
                    .then(html => {
                        document.getElementById('header-container').innerHTML = html;
                    })
                    .catch(error => console.error('Error loading header:', error));
                
                // Load footer
                fetch('../shared/footer.html')
                    .then(response => response.text())
                    .then(html => {
                        document.getElementById('footer-container').innerHTML = html;
                    })
                    .catch(error => console.error('Error loading footer:', error));
            }
            
            // Show place value explanation
            window.showPlaceValue = function(place, digit) {
                const values = {
                    'ten-thousands': 20000,
                    'thousands': 3000,
                    'hundreds': 400,
                    'tens': 50,
                    'ones': 6
                };
                
                const placeNames = {
                    'ten-thousands': 'Ten Thousands',
                    'thousands': 'Thousands',
                    'hundreds': 'Hundreds',
                    'tens': 'Tens',
                    'ones': 'Ones'
                };
                
                showNotification(
                    `${digit} in the ${placeNames[place]} place = ${values[place].toLocaleString()}`,
                    'success'
                );
            };
            
            // Start place value activity with drag-drop
            window.startPlaceValueActivity = function() {
                // Create drag-drop place value game
                const gameContainer = document.createElement('div');
                gameContainer.innerHTML = `
                    <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; display: flex; justify-content: center; align-items: center;">
                        <div style="background: white; padding: 2rem; border-radius: 1rem; max-width: 800px; width: 90%;">
                            <h3>üéÆ Place Value Drag & Drop Game</h3>
                            <p>Drag each digit to its correct place value position!</p>
                            
                            <div style="margin: 2rem 0;">
                                <div style="display: flex; gap: 1rem; justify-content: center; margin-bottom: 2rem;">
                                    <div class="draggable" data-digit="7" style="background: var(--primary-color); color: white; padding: 1rem; border-radius: 0.5rem; cursor: move; font-weight: bold; font-size: 1.5rem;">7</div>
                                    <div class="draggable" data-digit="3" style="background: var(--primary-color); color: white; padding: 1rem; border-radius: 0.5rem; cursor: move; font-weight: bold; font-size: 1.5rem;">3</div>
                                    <div class="draggable" data-digit="9" style="background: var(--primary-color); color: white; padding: 1rem; border-radius: 0.5rem; cursor: move; font-weight: bold; font-size: 1.5rem;">9</div>
                                    <div class="draggable" data-digit="2" style="background: var(--primary-color); color: white; padding: 1rem; border-radius: 0.5rem; cursor: move; font-weight: bold; font-size: 1.5rem;">2</div>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; max-width: 600px; margin: 0 auto;">
                                    <div class="drop-zone" data-place="thousands" style="background: var(--bg-secondary); border: 2px dashed var(--primary-color); padding: 2rem; text-align: center; border-radius: 0.5rem; min-height: 80px; display: flex; flex-direction: column; justify-content: center;">
                                        <strong>Thousands</strong>
                                        <small>1000s</small>
                                    </div>
                                    <div class="drop-zone" data-place="hundreds" style="background: var(--bg-secondary); border: 2px dashed var(--primary-color); padding: 2rem; text-align: center; border-radius: 0.5rem; min-height: 80px; display: flex; flex-direction: column; justify-content: center;">
                                        <strong>Hundreds</strong>
                                        <small>100s</small>
                                    </div>
                                    <div class="drop-zone" data-place="tens" style="background: var(--bg-secondary); border: 2px dashed var(--primary-color); padding: 2rem; text-align: center; border-radius: 0.5rem; min-height: 80px; display: flex; flex-direction: column; justify-content: center;">
                                        <strong>Tens</strong>
                                        <small>10s</small>
                                    </div>
                                    <div class="drop-zone" data-place="ones" style="background: var(--bg-secondary); border: 2px dashed var(--primary-color); padding: 2rem; text-align: center; border-radius: 0.5rem; min-height: 80px; display: flex; flex-direction: column; justify-content: center;">
                                        <strong>Ones</strong>
                                        <small>1s</small>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 1rem; justify-content: center;">
                                <button type="button" onclick="checkPlaceValueAnswer()" style="background: var(--success-color); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 0.5rem; cursor: pointer;">Check Answer</button>
                                <button type="button" onclick="closePlaceValueGame()" style="background: var(--secondary-color); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 0.5rem; cursor: pointer;">Close</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(gameContainer);
                
                // Initialize drag-drop for this game
                if (window.UniversalDragDrop) {
                    const dragDrop = new UniversalDragDrop({
                        dragSelector: '.draggable',
                        dropSelector: '.drop-zone',
                        onDrop: function(dragElement, dropElement) {
                            const digit = dragElement.getAttribute('data-digit');
                            const place = dropElement.getAttribute('data-place');
                            
                            // Visual feedback
                            dropElement.style.background = 'var(--success-color)';
                            dropElement.innerHTML = `<strong>${place}</strong><div style="font-size: 2rem; font-weight: bold; color: white;">${digit}</div>`;
                            dragElement.style.opacity = '0.3';
                            
                            // Award points for correct placement
                            if (window.GamificationSystem) {
                                window.gamificationSystem.awardPoints('drag_drop_correct');
                            }
                        }
                    });
                } else {
                    showNotification('‚ö†Ô∏è Drag-drop system loading...', 'info');
                }
                
                // Game functions
                window.checkPlaceValueAnswer = function() {
                    const correctAnswer = { thousands: '7', hundreds: '3', tens: '9', ones: '2' };
                    let correct = 0;
                    let total = 4;
                    
                    document.querySelectorAll('.drop-zone').forEach(zone => {
                        const place = zone.getAttribute('data-place');
                        const digit = zone.textContent.match(/\d/) ? zone.textContent.match(/\d/)[0] : null;
                        if (digit === correctAnswer[place]) {
                            correct++;
                            zone.style.borderColor = 'var(--success-color)';
                        } else {
                            zone.style.borderColor = 'var(--error-color)';
                        }
                    });
                    
                    const score = Math.round((correct / total) * 100);
                    showNotification(`üéØ Score: ${score}% (${correct}/${total} correct)`, score === 100 ? 'success' : 'info');
                    
                    if (window.GamificationSystem && score === 100) {
                        window.gamificationSystem.awardPoints('perfect_score', 2);
                        window.gamificationSystem.awardBadge('math_master');
                    }
                };
                
                window.closePlaceValueGame = function() {
                    gameContainer.remove();
                    delete window.checkPlaceValueAnswer;
                    delete window.closePlaceValueGame;
                };
            };
            
            // Start fraction activity
            window.startFractionActivity = function() {
                // Create comprehensive fraction activity
                const gameContainer = document.createElement('div');
                gameContainer.innerHTML = `
                    <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; display: flex; justify-content: center; align-items: center; overflow-y: auto;">
                        <div style="background: white; padding: 2rem; border-radius: 1rem; max-width: 900px; width: 95%; max-height: 90vh; overflow-y: auto;">
                            <h3>üßÆ Interactive Fraction Manipulatives</h3>
                            <p>Explore fractions with visual tools and hands-on activities!</p>
                            
                            <!-- Fraction Circles -->
                            <div style="margin: 2rem 0;">
                                <h4>üî¥ Fraction Circles - Adding Same Denominators</h4>
                                <p>Click the fraction circles to see how fractions with same denominators add together:</p>
                                
                                <div style="display: flex; gap: 2rem; justify-content: center; align-items: center; margin: 1.5rem 0;">
                                    <div class="fraction-visual-set">
                                        <div class="fraction-circle-demo" onclick="animateFractionAdd(1, 4)" style="width: 100px; height: 100px; border-radius: 50%; border: 3px solid #4A90E2; background: conic-gradient(#4A90E2 0deg 90deg, #f0f0f0 90deg 360deg); cursor: pointer; position: relative;">
                                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-weight: bold; color: #333;">1/4</div>
                                        </div>
                                        <p style="text-align: center; margin-top: 0.5rem;">1/4</p>
                                    </div>
                                    
                                    <div style="font-size: 2rem; color: #4A90E2;">+</div>
                                    
                                    <div class="fraction-visual-set">
                                        <div class="fraction-circle-demo" onclick="animateFractionAdd(1, 4)" style="width: 100px; height: 100px; border-radius: 50%; border: 3px solid #4A90E2; background: conic-gradient(#4A90E2 0deg 90deg, #f0f0f0 90deg 360deg); cursor: pointer; position: relative;">
                                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-weight: bold; color: #333;">1/4</div>
                                        </div>
                                        <p style="text-align: center; margin-top: 0.5rem;">1/4</p>
                                    </div>
                                    
                                    <div style="font-size: 2rem; color: #4A90E2;">=</div>
                                    
                                    <div class="fraction-visual-set">
                                        <div class="fraction-circle-demo result-circle" style="width: 100px; height: 100px; border-radius: 50%; border: 3px solid #7ED321; background: conic-gradient(#7ED321 0deg 180deg, #f0f0f0 180deg 360deg); position: relative;">
                                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-weight: bold; color: #333;">2/4</div>
                                        </div>
                                        <p style="text-align: center; margin-top: 0.5rem;">2/4 = 1/2</p>
                                    </div>
                                </div>
                                
                                <!-- More Examples -->
                                <div style="margin: 2rem 0;">
                                    <h5>üéØ Practice More Examples:</h5>
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-top: 1rem;">
                                        <div class="example-card" style="border: 2px solid #ddd; border-radius: 0.5rem; padding: 1rem; background: #f9f9f9;">
                                            <div class="example-equation" style="font-size: 1.2rem; margin-bottom: 0.5rem; text-align: center;">
                                                2/8 + 3/8 = ?
                                            </div>
                                            <button type="button" onclick="showFractionSolution('2/8 + 3/8 = 5/8')" style="width: 100%; padding: 0.5rem; background: #4A90E2; color: white; border: none; border-radius: 0.25rem; cursor: pointer;">
                                                Show Solution
                                            </button>
                                        </div>
                                        
                                        <div class="example-card" style="border: 2px solid #ddd; border-radius: 0.5rem; padding: 1rem; background: #f9f9f9;">
                                            <div class="example-equation" style="font-size: 1.2rem; margin-bottom: 0.5rem; text-align: center;">
                                                1/6 + 2/6 = ?
                                            </div>
                                            <button type="button" onclick="showFractionSolution('1/6 + 2/6 = 3/6 = 1/2')" style="width: 100%; padding: 0.5rem; background: #4A90E2; color: white; border: none; border-radius: 0.25rem; cursor: pointer;">
                                                Show Solution
                                            </button>
                                        </div>
                                        
                                        <div class="example-card" style="border: 2px solid #ddd; border-radius: 0.5rem; padding: 1rem; background: #f9f9f9;">
                                            <div class="example-equation" style="font-size: 1.2rem; margin-bottom: 0.5rem; text-align: center;">
                                                3/10 + 4/10 = ?
                                            </div>
                                            <button type="button" onclick="showFractionSolution('3/10 + 4/10 = 7/10')" style="width: 100%; padding: 0.5rem; background: #4A90E2; color: white; border: none; border-radius: 0.25rem; cursor: pointer;">
                                                Show Solution
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Fraction Bars -->
                                <div style="margin: 2rem 0;">
                                    <h4>üìä Fraction Bars - Visual Addition</h4>
                                    <p>Watch how fraction bars show addition clearly:</p>
                                    
                                    <div style="display: flex; flex-direction: column; gap: 1rem; align-items: center; margin: 1.5rem 0;">
                                        <div class="fraction-bar-example">
                                            <div style="font-weight: bold; margin-bottom: 0.5rem;">2/5 + 1/5 =</div>
                                            <div style="display: flex; align-items: center; gap: 1rem;">
                                                <div class="fraction-bar" style="width: 150px; height: 30px; border: 2px solid #333; display: flex;">
                                                    <div style="width: 40%; background: #FF6B35;"></div>
                                                    <div style="width: 60%; background: #f0f0f0;"></div>
                                                </div>
                                                <span style="font-size: 1.5rem;">+</span>
                                                <div class="fraction-bar" style="width: 150px; height: 30px; border: 2px solid #333; display: flex;">
                                                    <div style="width: 20%; background: #4ECDC4;"></div>
                                                    <div style="width: 80%; background: #f0f0f0;"></div>
                                                </div>
                                                <span style="font-size: 1.5rem;">=</span>
                                                <div class="fraction-bar" style="width: 150px; height: 30px; border: 2px solid #333; display: flex;">
                                                    <div style="width: 60%; background: #7ED321;"></div>
                                                    <div style="width: 40%; background: #f0f0f0;"></div>
                                                </div>
                                                <strong style="color: #7ED321;">3/5</strong>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem;">
                                <button type="button" onclick="generateRandomFractionProblem()" style="background: var(--secondary-color); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 0.5rem; cursor: pointer;">
                                    üé≤ Generate New Problem
                                </button>
                                <button type="button" onclick="closeFractionActivity()" style="background: var(--accent-color); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 0.5rem; cursor: pointer;">
                                    Close Activity
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(gameContainer);
                window.currentFractionGame = gameContainer;
                showNotification('üßÆ Fraction Manipulatives Loaded! Explore visual fraction operations.', 'success');
            };
            
            // Supporting functions for fraction activity
            window.showFractionSolution = function(solution) {
                showNotification('‚úÖ ' + solution, 'success');
            };
            
            window.animateFractionAdd = function(numerator, denominator) {
                showNotification(`üéØ Adding ${numerator}/${denominator} + ${numerator}/${denominator} = ${numerator*2}/${denominator}`, 'info');
            };
            
            window.generateRandomFractionProblem = function() {
                const denominators = [4, 6, 8, 10, 12];
                const denom = denominators[Math.floor(Math.random() * denominators.length)];
                const num1 = Math.floor(Math.random() * (denom - 1)) + 1;
                const num2 = Math.floor(Math.random() * (denom - num1)) + 1;
                const answer = num1 + num2;
                
                showNotification(`üé≤ New Problem: ${num1}/${denom} + ${num2}/${denom} = ${answer}/${denom}`, 'info');
            };
            
            window.closeFractionActivity = function() {
                if (window.currentFractionGame) {
                    window.currentFractionGame.remove();
                    delete window.currentFractionGame;
                }
            };
            
            // Start decimal activity - Enhanced with visual tools
            window.startDecimalActivity = function() {
                const gameContainer = document.createElement('div');
                gameContainer.innerHTML = `
                    <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; display: flex; justify-content: center; align-items: center; overflow-y: auto;">
                        <div style="background: white; padding: 2rem; border-radius: 1rem; max-width: 800px; width: 95%; max-height: 90vh; overflow-y: auto;">
                            <h3>üìè Decimal Place Value Explorer</h3>
                            <p>Visual tools for comparing and ordering decimals!</p>
                            
                            <!-- Decimal Number Line -->
                            <div style="margin: 2rem 0;">
                                <h4>üìä Decimal Number Line</h4>
                                <p>Click on the number line to explore decimal values:</p>
                                
                                <div style="margin: 1.5rem 0; text-align: center;">
                                    <svg width="600" height="100" style="max-width: 100%;">
                                        <!-- Main line -->
                                        <line x1="50" y1="50" x2="550" y2="50" stroke="#333" stroke-width="3"/>
                                        
                                        <!-- Major marks -->
                                        <line x1="50" y1="40" x2="50" y2="60" stroke="#333" stroke-width="2"/>
                                        <text x="50" y="80" text-anchor="middle" font-size="14">0</text>
                                        
                                        <line x1="150" y1="40" x2="150" y2="60" stroke="#333" stroke-width="2"/>
                                        <text x="150" y="80" text-anchor="middle" font-size="14">0.2</text>
                                        
                                        <line x1="250" y1="40" x2="250" y2="60" stroke="#333" stroke-width="2"/>
                                        <text x="250" y="80" text-anchor="middle" font-size="14">0.4</text>
                                        
                                        <line x1="350" y1="40" x2="350" y2="60" stroke="#333" stroke-width="2"/>
                                        <text x="350" y="80" text-anchor="middle" font-size="14">0.6</text>
                                        
                                        <line x1="450" y1="40" x2="450" y2="60" stroke="#333" stroke-width="2"/>
                                        <text x="450" y="80" text-anchor="middle" font-size="14">0.8</text>
                                        
                                        <line x1="550" y1="40" x2="550" y2="60" stroke="#333" stroke-width="2"/>
                                        <text x="550" y="80" text-anchor="middle" font-size="14">1.0</text>
                                        
                                        <!-- Interactive points -->
                                        <circle cx="100" cy="50" r="6" fill="#FF6B35" onclick="explainDecimal(0.1)" style="cursor: pointer;"/>
                                        <text x="100" y="30" text-anchor="middle" font-size="12" fill="#FF6B35">0.1</text>
                                        
                                        <circle cx="175" cy="50" r="6" fill="#4ECDC4" onclick="explainDecimal(0.25)" style="cursor: pointer;"/>
                                        <text x="175" y="30" text-anchor="middle" font-size="12" fill="#4ECDC4">0.25</text>
                                        
                                        <circle cx="375" cy="50" r="6" fill="#9013FE" onclick="explainDecimal(0.65)" style="cursor: pointer;"/>
                                        <text x="375" y="30" text-anchor="middle" font-size="12" fill="#9013FE">0.65</text>
                                    </svg>
                                </div>
                            </div>
                            
                            <!-- Decimal Comparison -->
                            <div style="margin: 2rem 0;">
                                <h4>üîç Compare Decimals</h4>
                                <p>Which decimal is larger? Click to compare:</p>
                                
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
                                    <div class="comparison-card" style="border: 2px solid #ddd; border-radius: 0.5rem; padding: 1rem; text-align: center;">
                                        <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem;">0.7 vs 0.65</div>
                                        <button type="button" onclick="compareDecimals(0.7, 0.65)" style="width: 100%; padding: 0.5rem; background: #FF6B35; color: white; border: none; border-radius: 0.25rem; cursor: pointer;">
                                            Compare
                                        </button>
                                    </div>
                                    
                                    <div class="comparison-card" style="border: 2px solid #ddd; border-radius: 0.5rem; padding: 1rem; text-align: center;">
                                        <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem;">0.3 vs 0.30</div>
                                        <button type="button" onclick="compareDecimals(0.3, 0.30)" style="width: 100%; padding: 0.5rem; background: #4ECDC4; color: white; border: none; border-radius: 0.25rem; cursor: pointer;">
                                            Compare
                                        </button>
                                    </div>
                                    
                                    <div class="comparison-card" style="border: 2px solid #ddd; border-radius: 0.5rem; padding: 1rem; text-align: center;">
                                        <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem;">0.85 vs 0.8</div>
                                        <button type="button" onclick="compareDecimals(0.85, 0.8)" style="width: 100%; padding: 0.5rem; background: #9013FE; color: white; border: none; border-radius: 0.25rem; cursor: pointer;">
                                            Compare
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Decimal Place Value -->
                            <div style="margin: 2rem 0;">
                                <h4>üéØ Decimal Place Value</h4>
                                <p>Explore the value of each digit in a decimal:</p>
                                
                                <div style="display: flex; justify-content: center; align-items: center; margin: 1.5rem 0;">
                                    <div class="decimal-breakdown" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.5rem; max-width: 400px; border: 2px solid #333; border-radius: 0.5rem; overflow: hidden;">
                                        <div style="background: #FF6B35; color: white; padding: 1rem; text-align: center;">
                                            <div style="font-size: 2rem; font-weight: bold;">3</div>
                                            <div style="font-size: 0.8rem;">Ones</div>
                                        </div>
                                        <div style="background: #333; color: white; padding: 1rem; text-align: center;">
                                            <div style="font-size: 2rem; font-weight: bold;">.</div>
                                            <div style="font-size: 0.8rem;">Point</div>
                                        </div>
                                        <div style="background: #4ECDC4; color: white; padding: 1rem; text-align: center;">
                                            <div style="font-size: 2rem; font-weight: bold;">7</div>
                                            <div style="font-size: 0.8rem;">Tenths</div>
                                        </div>
                                        <div style="background: #9013FE; color: white; padding: 1rem; text-align: center;">
                                            <div style="font-size: 2rem; font-weight: bold;">5</div>
                                            <div style="font-size: 0.8rem;">Hundredths</div>
                                        </div>
                                    </div>
                                </div>
                                <p style="text-align: center; font-size: 1.1rem;">3.75 = 3 ones + 7 tenths + 5 hundredths</p>
                            </div>
                            
                            <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem;">
                                <button type="button" onclick="generateRandomDecimalProblem()" style="background: var(--secondary-color); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 0.5rem; cursor: pointer;">
                                    üé≤ Random Comparison
                                </button>
                                <button type="button" onclick="closeDecimalActivity()" style="background: var(--accent-color); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 0.5rem; cursor: pointer;">
                                    Close Activity
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(gameContainer);
                window.currentDecimalGame = gameContainer;
                showNotification('üìè Decimal Explorer Loaded! Click around to explore.', 'success');
            };
            
            // Supporting functions for decimal activity
            window.explainDecimal = function(value) {
                const hundredths = Math.round(value * 100);
                showNotification(`üéØ ${value} = ${hundredths} hundredths`, 'info');
            };
            
            window.compareDecimals = function(a, b) {
                if (a > b) {
                    showNotification(`‚úÖ ${a} > ${b} because ${a} has a larger value!`, 'success');
                } else if (a < b) {
                    showNotification(`‚úÖ ${b} > ${a} because ${b} has a larger value!`, 'success');
                } else {
                    showNotification(`‚úÖ ${a} = ${b} - They are equal!`, 'success');
                }
            };
            
            window.generateRandomDecimalProblem = function() {
                const a = (Math.random() * 0.9 + 0.1).toFixed(2);
                const b = (Math.random() * 0.9 + 0.1).toFixed(2);
                const larger = parseFloat(a) > parseFloat(b) ? a : b;
                showNotification(`üé≤ Compare: ${a} vs ${b}. Answer: ${larger} is larger!`, 'info');
            };
            
            window.closeDecimalActivity = function() {
                if (window.currentDecimalGame) {
                    window.currentDecimalGame.remove();
                    delete window.currentDecimalGame;
                }
            };
            
            // Reveal answer for practice problems
            window.revealAnswer = function(answer) {
                showNotification(answer, 'success');
            };
            
            // Generate practice problem
            window.generateProblem = function() {
                const num1 = Math.floor(Math.random() * 500) + 100;
                const num2 = Math.floor(Math.random() * 300) + 50;
                const answer = num1 + num2;
                
                showNotification(
                    `üé≤ New Problem: ${num1} + ${num2} = ?  (Answer: ${answer})`,
                    'success'
                );
            };
            
            // Simple notification system
            function showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: ${type === 'success' ? 'var(--success-color)' : 'var(--primary-color)'};
                    color: white;
                    padding: var(--spacing-md) var(--spacing-lg);
                    border-radius: var(--radius-md);
                    box-shadow: var(--shadow-lg);
                    z-index: 1000;
                    max-width: 300px;
                    animation: slideIn 0.3s ease-out;
                `;
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                // Remove after 4 seconds
                setTimeout(() => {
                    notification.remove();
                }, 4000);
            }
            
            // Initialize page interactions
            function initializePage() {
                // Add interactive hover effects to visual elements
                const visualElements = document.querySelectorAll('.visual-element');
                visualElements.forEach(element => {
                    element.addEventListener('click', () => {
                        element.style.transform = 'scale(1.05)';
                        setTimeout(() => {
                            element.style.transform = '';
                        }, 200);
                    });
                });
                
                // Track chapter progress (simplified)
                updateProgress();
            }
            
            // Update progress tracking
            function updateProgress() {
                // Mark this chapter as 25% complete
                const progress = { 'chapter-1': 25 };
                localStorage.setItem('math-progress', JSON.stringify(progress));
            }
            
            // Initialize on page load
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', () => {
                    loadSharedComponents();
                    initializePage();
                });
            } else {
                loadSharedComponents();
                initializePage();
            }
        })();
    </script>
    
    <style>
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</body>
</html>
